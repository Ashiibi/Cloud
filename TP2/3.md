üåû Constater le d√©ploiement

depuis la WebUI si tu veux
pour le compte-rendu : depuis le CLI az

az vm list
az vm show --name VM_NAME --resource-group RESOURCE_GROUP_NAME
az group list
n'oubliez pas que vous pouvez ajouter -o table pour avoir un output plus lisible par un humain :)
```
az>> vm list -o table
Name            ResourceGroup          Location    Zones
--------------  ---------------------  ----------  -------
tp2magueule-vm  TP2MAGUEULE-RESOURCES  westeurope


az>> az vm show --name tp2magueule-vm --resource-group tp2magueule-resources -o table
Name            ResourceGroup          Location    Zones
--------------  ---------------------  ----------  -------
tp2magueule-vm  tp2magueule-resources  westeurope


az>> az group list -o table
Name                    Location    Status
----------------------  ----------  ---------
MurkyDivers             westeurope  Succeeded
NetworkWatcherRG        westeurope  Succeeded
tp2magueule-resources   westeurope  Succeeded
```
‚ûú Autres commandes Terraform ( pour moi )
```
# V√©rifier que votre fichier .tf est valide
$ terraform validate

# Formate un fichier .tf au format standard
$ terraform fmt

# Afficher les ressources du d√©ploiement
$ terraform state list

# Afficher les d√©tails d'une des ressources du d√©ploiement
$ terraform state show <RESSOURCE>

# D√©truit les ressources d√©ploy√©es
$ terraform destroy

```


üåû Cr√©er un plan Terraform avec les contraintes suivantes
node1

Ubuntu 22.04
1 IP Publique
1 IP Priv√©e

node2

Ubuntu 22.04
1 IP Priv√©e
les IPs priv√©es doivent permettre aux deux machines de se ping

```
provider "azurerm" {
  features {}
  subscription_id = "672afa01-c969-4945-b2a1-f36ed2424d6a"
}

resource "azurerm_resource_group" "main" {
  name     = "${var.prefix}-resources"
  location = var.location
}

resource "azurerm_virtual_network" "main" {
  name                = "${var.prefix}-network"
  address_space       = ["10.0.0.0/16"]
  location            = azurerm_resource_group.main.location
  resource_group_name = azurerm_resource_group.main.name
}

resource "azurerm_subnet" "internal" {
  name                 = "internal"
  resource_group_name  = azurerm_resource_group.main.name
  virtual_network_name = azurerm_virtual_network.main.name
  address_prefixes     = ["10.0.2.0/24"]
}

resource "azurerm_public_ip" "pip" {
  name                = "${var.prefix}-pip"
  resource_group_name = azurerm_resource_group.main.name
  location            = azurerm_resource_group.main.location
  allocation_method   = "Static"
}

resource "azurerm_network_interface" "node1" {
  name                = "${var.prefix}-nic1"
  resource_group_name = azurerm_resource_group.main.name
  location            = azurerm_resource_group.main.location
  ip_configuration {
    name                          = "primary"
    subnet_id                     = azurerm_subnet.internal.id
    private_ip_address_allocation = "Dynamic"
    public_ip_address_id          = azurerm_public_ip.pip.id
  }
}

resource "azurerm_network_interface" "node2" {
  name                = "${var.prefix}-nic2"
  resource_group_name = azurerm_resource_group.main.name
  location            = azurerm_resource_group.main.location
  ip_configuration {
    name                          = "internal"
    subnet_id                     = azurerm_subnet.internal.id
    private_ip_address_allocation = "Dynamic"
  }
}

resource "azurerm_network_security_group" "ssh" {
  name                = "ssh"
  location            = azurerm_resource_group.main.location
  resource_group_name = azurerm_resource_group.main.name
  security_rule {
    access                     = "Allow"
    direction                  = "Inbound"
    name                       = "ssh"
    priority                   = 100
    protocol                   = "Tcp"
    source_port_range          = "*"
    source_address_prefix      = "*"
    destination_port_range     = "22"
    destination_address_prefix = "*"
  }
}

resource "azurerm_network_interface_security_group_association" "node1" {
  network_interface_id      = azurerm_network_interface.node1.id
  network_security_group_id = azurerm_network_security_group.ssh.id
}

resource "azurerm_network_interface_security_group_association" "node2" {
  network_interface_id      = azurerm_network_interface.node2.id
  network_security_group_id = azurerm_network_security_group.ssh.id
}

resource "azurerm_linux_virtual_machine" "node1" {
  name                            = "${var.prefix}-vm1"
  resource_group_name             = azurerm_resource_group.main.name
  location                        = azurerm_resource_group.main.location
  size                            = "Standard_F2"
  admin_username                  = "ashiibi"
  network_interface_ids = [
    azurerm_network_interface.node1.id,
  ]
  admin_ssh_key {
    username   = "ashiibi"
    public_key = file("C:\\Users\\sacha\\.ssh\\id_rsa.pub")
  }
  source_image_reference {
    publisher = "Canonical"
    offer     = "0001-com-ubuntu-server-jammy"
    sku       = "22_04-lts"
    version   = "latest"
  }
  os_disk {
    storage_account_type = "Standard_LRS"
    caching              = "ReadWrite"
  }
}

resource "azurerm_linux_virtual_machine" "node2" {
  name                            = "${var.prefix}-vm2"
  resource_group_name             = azurerm_resource_group.main.name
  location                        = azurerm_resource_group.main.location
  size                            = "Standard_F2"
  admin_username                  = "ashiibi"
  network_interface_ids = [
    azurerm_network_interface.node2.id,
  ]
  admin_ssh_key {
    username   = "ashiibi"
    public_key = file("C:\\Users\\sacha\\.ssh\\id_rsa.pub")
  }
  source_image_reference {
    publisher = "Canonical"
    offer     = "0001-com-ubuntu-server-jammy"
    sku       = "22_04-lts"
    version   = "latest"
  }
  os_disk {
    storage_account_type = "Standard_LRS"
    caching              = "ReadWrite"
  }
}
```
```
ashiibi@tp2magueule-vm1:~$ ping 10.0.2.4
PING 10.0.2.4 (10.0.2.4) 56(84) bytes of data.
64 bytes from 10.0.2.4: icmp_seq=1 ttl=64 time=2.12 ms
64 bytes from 10.0.2.4: icmp_seq=2 ttl=64 time=0.939 ms
```
```
PS C:\Users\sacha> ssh -J ashiibi@20.160.147.79 ashiibi@10.0.2.4
The authenticity of host '10.0.2.4 (<no hostip for proxy command>)' can't be established.
ED25519 key fingerprint is SHA256:ffGGerm2ZMgEEMTML1cKudtWa630iWui03Cy/XQ5ftE.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.0.2.4' (ED25519) to the list of known hosts.
Welcome to Ubuntu 22.04.5 LTS (GNU/Linux 6.8.0-1021-azure x86_64)
```

üåû Int√©grer la gestion de cloud-init
-> Jpense pas avoir besoin de le refaire vu qu'il est dans la partie d'avant :^)
